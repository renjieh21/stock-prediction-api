# ğŸ“ˆ Stock Return Prediction API (PyTorch + FastAPI + Docker)

A complete endâ€‘toâ€‘end machine learning system for **predicting future stock returns** using  
**PyTorch**, **FastAPI**, and **Docker**.  

This project demonstrates fullâ€‘stack ML engineering skills, including:

- Data ingestion & feature engineering (yfinance + pandas)
- PyTorch model training & evaluation
- StandardScaler preprocessing export
- Fully deployable FastAPI prediction service
- Dockerized API for portable deployment
- Project structure following MLOps & modern backend best practices

This repository is designed as a strong CS Masterâ€™s application project â€” clear structure, reproducible results, and deploymentâ€‘ready API.

> **Note:** The API already includes pre-trained artifacts in the `model/` directory (`model.pth` and `scaler.joblib`).  
> You do **not** need to run `src/train.py` unless you want to retrain or improve the model.  
> The Docker container loads these artifacts automatically at startup.

---

## ğŸš€ Project Architecture

```
stock-return-prediction-pytorch/
â”‚
â”œâ”€â”€ app/                    # FastAPI application
â”‚   â”œâ”€â”€ main.py             # Loads model + defines prediction endpoints
â”‚   â””â”€â”€ schemas.py          # Pydantic v2 model schemas
â”‚
â”œâ”€â”€ src/                    # ML pipeline (training & data processing)
â”‚   â”œâ”€â”€ data_loader.py      # Download data & feature engineering
â”‚   â”œâ”€â”€ dataset.py          # PyTorch Dataset wrapper
â”‚   â”œâ”€â”€ model_def.py        # MLP regression model
â”‚   â””â”€â”€ train.py            # Training script (produces model artifacts)
â”‚
â”œâ”€â”€ model/                  # Saved artifacts (generated by train.py)
â”‚   â”œâ”€â”€ model.pth           # Trained PyTorch model
â”‚   â””â”€â”€ scaler.joblib       # Preprocessing scaler
â”‚
â”œâ”€â”€ Dockerfile              # Containerized API
â”œâ”€â”€ requirements.txt        # Clean Python dependencies
â””â”€â”€ README.md               # You are here
```

---

## ğŸ“Š 1. Data Processing

Data is pulled from Yahoo Finance using `yfinance`, and engineered with:

- 1â€‘day / 5â€‘day returns  
- 10â€‘day / 50â€‘day SMAs  
- RSIâ€‘14  
- 10â€‘day rolling volatility  
- Volume change  
- Future *Nâ€‘day return* as regression target  

Feature + target creation code lives in:

```
src/data_loader.py
```

Example:

```python
data, feature_cols, target_col = get_processed_data(
    ticker="AAPL",
    start_date="2015-01-01",
    end_date="2023-12-31",
    future_days=5
)
```

---

## ğŸ¤– 2. Model Training (PyTorch)

The predictive model is a **Multiâ€‘Layer Perceptron regression network** with:

- BatchNorm  
- Dropout  
- Adam optimizer  
- MSE loss  

Training pipeline: `src/train.py`

```
python src/train.py --ticker "AAPL" --epochs 50
```

Artifacts created:

```
model/model.pth
model/scaler.joblib
```

---

## ğŸŒ 3. FastAPI Deployment

FastAPI app loads the trained model & scaler once at startup:

Endpoints:

| Method | Path             | Description |
|--------|------------------|-------------|
| GET    | `/`              | Health check |
| POST   | `/predict`       | Predict for a single input |
| POST   | `/predict_batch` | Batch inference |

Run locally:

```bash
export PYTHONPATH=$PYTHONPATH:$(pwd)
uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload
```

Interactive docs available at:

â¡ï¸ http://127.0.0.1:8000/docs

---

## ğŸ³ 4. Docker Deployment

### Build image:

```bash
docker build -t stock-api .
```

### Run container:

```bash
docker run -p 8000:8000 stock-api
```

API available at:

â¡ï¸ http://127.0.0.1:8000/docs

---

## ğŸ“¦ 5. requirements.txt (Clean, Dockerâ€‘friendly)

This project uses **Pydantic v2**, which eliminates the metaclass conflicts seen in early runs.

```
fastapi==0.110.0
uvicorn[standard]==0.27.1
torch==2.1.0
scikit-learn==1.3.2
joblib==1.3.2
numpy==1.26.4
pandas==2.1.1
yfinance==0.2.38
pydantic==2.10.3
pydantic-settings==2.2.1
```

---



## ğŸ“š 6. Key Skills Demonstrated

This project demonstrates:

- Machine Learning (PyTorch, feature engineering)
- Backend engineering (FastAPI)
- Deployment (Docker)
- Software engineering (modular repo, configs, reproducibility)
- Understanding of financial timeâ€‘series

Strong evidence of readiness for CS / AI graduate study.

---

## ğŸ“ Author

Created by **Renjie Hu**,  
Quantitative Risk Analyst & CS/AI enthusiast.

---
